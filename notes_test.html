<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Notes Parsing Test</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background-color: #f7f7f7; color: #333; }
        h1 { text-align: center; }
        .test-case { border: 1px solid #ccc; padding: 10px 20px; margin-bottom: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .pass { background-color: #e8f5e9; border-left: 5px solid #4CAF50; }
        .fail { background-color: #ffebee; border-left: 5px solid #f44336; }
        h3 { margin-top: 0; }
        pre { background-color: #eee; padding: 10px; border-radius: 4px; white-space: pre-wrap; word-break: break-all; font-size: 14px; }
        code { font-family: "Courier New", Courier, monospace; }
    </style>
</head>
<body>
    <h1>Notes Parsing Logic Test Suite</h1>
    <p>This page tests the <code>convertNotesToLinks</code> function to ensure it correctly handles various formats from the CSV.</p>

    <div id="test-results"></div>

    <script>
        // --- The function to be tested (copied from index.html) ---
        function convertNotesToLinks(notesText) {
            if (!notesText || typeof notesText !== 'string') return '';

            // Robustly split by comma, then trim whitespace from each part.
            const parts = notesText.split(',');
            const linkElements = [];

            parts.forEach(part => {
                const trimmedPart = part.trim();
                if (!trimmedPart) return; // Skip empty parts (e.g., from a trailing comma)

                const isLink = trimmedPart.startsWith('http') || /\.(pdf|md|png|jpg|jpeg|gif|svg)$/i.test(trimmedPart);

                if (isLink) {
                    const filename = trimmedPart.split('/').pop();
                    const displayName = filename.replace(/\.[^/.]+$/, "").replace(/[_-]/g, ' ');
                    linkElements.push(`<li><a href="#" onclick="return false;">${displayName}</a></li>`);
                } else {
                    linkElements.push(`<li>${trimmedPart}</li>`);
                }
            });

            if (linkElements.length > 0) {
                return `<ul>${linkElements.join('')}</ul>`;
            }
            return '';
        }

        // --- Test Runner ---
        const testResultsContainer = document.getElementById('test-results');

        function runTest(description, input, expectedOutput) {
            // In the test, we simplify the 'onclick' for easier comparison.
            const actualOutput = convertNotesToLinks(input);
            const passed = actualOutput === expectedOutput;

            const testCaseDiv = document.createElement('div');
            testCaseDiv.className = `test-case ${passed ? 'pass' : 'fail'}`;

            testCaseDiv.innerHTML = `
                <h3>${description}: ${passed ? '✅ PASS' : '❌ FAIL'}</h3>
                <strong>Input:</strong><pre>${input || '(empty)'}</pre>
                <strong>Expected Output:</strong><pre>${expectedOutput}</pre>
                <strong>Actual Output:</strong><pre>${actualOutput}</pre>
            `;
            testResultsContainer.appendChild(testCaseDiv);
        }

        // --- Test Cases ---

        // Test 1: Jon Batiste - Mix of note and two links
        runTest(
            'Test Case 1: Jon Batiste - Note and multiple links',
            'Area 5(1), souvenirs/What_A_Wonderful_World_lyrics.md, souvenirs/What_A_Wonderful_World.png',
            '<ul><li>Area 5(1)</li><li><a href="#" onclick="return false;">What A Wonderful World lyrics</a></li><li><a href="#" onclick="return false;">What A Wonderful World</a></li></ul>'
        );
        
        // Test 2: Don't Know Why - Two links, separated by comma and space (CORRECT way)
        runTest(
            'Test Case 2: Don\'t Know Why - Two links (Correct CSV Format)',
            'souvenirs/Dont_Know_Why_(1).pdf, souvenirs/Dont_Know_Why_(2).pdf',
            '<ul><li><a href="#" onclick="return false;">Dont Know Why (1)</a></li><li><a href="#" onclick="return false;">Dont Know Why (2)</a></li></ul>'
        );

        // Test 3: Don't Know Why - Two links, separated by only a space (INCORRECT way)
        // This test proves *why* the CSV needs a comma. The actual output shows it is treated as one broken link.
        runTest(
            'Test Case 3: Don\'t Know Why - Two links with space only (Incorrect CSV Format)',
            'souvenirs/Dont_Know_Why_(1).pdf souvenirs/Dont_Know_Why_(2).pdf',
            '<ul><li><a href="#" onclick="return false;">Dont Know Why (2)</a></li></ul>'
        );

        // Test 4: Single plain note
        runTest(
            'Test Case 4: Single plain text note',
            'First Song by ear.',
            '<ul><li>First Song by ear.</li></ul>'
        );
        
        // Test 5: Single link with no other text
        runTest(
            'Test Case 5: Single relative link',
            'souvenirs/the_luckiest.md',
            '<ul><li><a href="#" onclick="return false;">the luckiest</a></li></ul>'
        );

        // Test 6: Empty or null note
        runTest(
            'Test Case 6: Empty note',
            '',
            ''
        );
        
        // Test 7: Note with an internal comma but no link
        runTest(
            'Test Case 7: Note with an internal comma',
            'A very, very important note',
            '<ul><li>A very</li><li>very important note</li></ul>'
        );

    </script>
</body>
</html>