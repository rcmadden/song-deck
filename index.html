<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Song Deck</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background-color: #333;
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 32px;
        }
        
        .header-icons {
            display: flex;
            gap: 20px;
        }
        
        .header-icon {
            font-size: 24px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 0;
            background-color: white;
        }
        
        tr {
            border-bottom: 1px solid #ddd;
            cursor: pointer;
        }
        
        tr:hover {
            background-color: #f9f9f9;
        }
        
        th, td {
            padding: 15px 20px;
            text-align: left;
        }
        
        td.club {
            font-size: 20px;
        }
        
        .song-title {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .song-artist {
            font-style: italic;
            color: #666;
        }
        
        .detail-card {
            border: 1px solid #ddd;
            margin-bottom: 20px;
            background-color: white;
        }
        
        .detail-header {
            display: flex;
            background-color: #f9f9f9;
            padding: 15px 20px;
            align-items: center;
        }
        
        .card-symbol {
            font-size: 48px;
            margin-right: 20px;
        }
        
        .card-title {
            flex-grow: 1;
        }
        
        .card-title h2 {
            margin: 0 0 5px 0;
        }
        
        .card-title p {
            margin: 0;
            font-style: italic;
            color: #666;
        }
        
        .card-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .card-info div {
            margin-left: 10px;
            display: flex;
            align-items: center;
        }
        
        .detail-content {
            padding: 20px;
        }
        
        .detail-content p {
            margin: 0 0 10px 0;
        }
        
        .puzzle-piece {
            margin-top: 30px;
            display: flex;
            align-items: center;
        }
        
        .puzzle-icon {
            margin-right: 10px;
            font-size: 24px;
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>SONG</h1>
            <div class="header-icons">
                <div class="header-icon">üß©</div>
                <div class="header-icon">üîë</div>
            </div>
        </div>
        
        <table id="songTable">
            <tbody id="songTableBody">
                <!-- Table rows will be populated by JavaScript -->
            </tbody>
        </table>
        
        <div id="detailCard" class="detail-card hidden">
            <!-- Card details will be populated by JavaScript -->
        </div>
    </div>

    <script>
        // This will store our song data
        let songData = [];
        
        // Function to get suit symbol based on card value
        function getSuitSymbol(card) {
            // Card can be a string or number
            if (typeof card === 'string') {
                return '‚ô£Ô∏è'; // Default to clubs for string values (A, J, Q, K)
            } else if (typeof card === 'number') {
                return '‚ô£Ô∏è'; // Clubs for number cards
            }
            return '‚ô£Ô∏è';
        }
        
        // Function to load and parse CSV data
        // This function should read the songDB.csv file into a variable
        // and then call renderSongTable() to display the data
        // If the CSV file is not found or cannot be read, it will return an error

        async function loadSongData() {
            try {
                const response = await fetch('songDB.csv');
                const csvText = await response.text();
                
                // Simple CSV parsing (alternative to using a library)
                const rows = csvText.split('\n');
                const headers = rows[0].split(',');
                
                for (let i = 1; i < rows.length; i++) {
                    if (rows[i].trim() === '') continue;
                    
                    // Handle possible commas within quoted values
                    let row = rows[i];
                    let values = [];
                    let inQuotes = false;
                    let currentValue = '';
                    
                    for (let j = 0; j < row.length; j++) {
                        const char = row[j];
                        
                        if (char === '"' && (j === 0 || row[j-1] !== '\\')) {
                            inQuotes = !inQuotes;
                        } else if (char === ',' && !inQuotes) {
                            values.push(currentValue.trim());
                            currentValue = '';
                        } else {
                            currentValue += char;
                        }
                    }
                    
                    values.push(currentValue.trim());
                    
                    // Create object from headers and values
                    const rowData = {};
                    for (let j = 0; j < headers.length && j < values.length; j++) {
                        rowData[headers[j].trim()] = values[j].replace(/^"|"$/g, '');
                    }
                    
                    songData.push(rowData);
                }
                
                renderSongTable();
            } catch (error) {
                console.error('Error loading song data:', error);
                // Fallback to hardcoded data if loading fails
                loadHardcodedData();
            }
        }
        
        
        function loadHardcodedData() {
            songData = [  
                { Index: 1, Card: "A", Title: "Music for Airports", Artist: "Brian Eno", Key: "D", BPM: 83, Date: 1978, "Puzzle Piece": "1-4-5-Resolution(3)", "Em&a": "", Notes: "First Song by ear.", "Time Signature": "" },
                { Index: 2, Card: "2", Title: "All of Me", Artist: "John Legend", Key: "A", BPM: "", Date: 2013, "Puzzle Piece": "6-4-1-5", "Em&a": "", Notes: "", "Time Signature": "" },
                { Index: 3, Card: "3", Title: "The Luckiest", Artist: "Ben Folds", Key: "D", BPM: 60, Date: 2001, "Puzzle Piece": "1/5,Verse every note in the landscape", "Em&a": "Amanda", Notes: "https://rcmadden.github.io/song-deck/souveneirs/The-Luckiest.md", "Time Signature": "" },
                { Index: 4, Card: "4", Title: "Amazing Grace", Artist: "Elvis Presley", Key: "F", BPM: "", Date: 1972, "Puzzle Piece": "2 Chord Sandwich", "Em&a": "", Notes: "", "Time Signature": "" },
                { Index: 5, Card: "5", Title: "Tennessee Whiskey", Artist: "Chris Stapleton", Key: "A", BPM: "", Date: 2015, "Puzzle Piece": "1-2-1 Chord Sandwich", "Em&a": "Emma", Notes: "", "Time Signature": "" },
                { Index: 6, Card: "6", Title: "(What a) Wonderful World", Artist: "Art Garfunkel", Key: "", BPM: "", Date: 1977, "Puzzle Piece": "", "Em&a": "", Notes: "", "Time Signature": "" },
                { Index: 7, Card: "7", Title: "(What a) Wonderful World", Artist: "Jon Batiste", Key: "E", BPM: 178, Date: 2018, "Puzzle Piece": "Area 5(1)", "Em&a": "Amanda", Notes: "", "Time Signature": "" },
                { Index: 8, Card: "8", Title: "Dusklight Movement", Artist: "Jon Batiste", Key: "D or G", BPM: "", Date: 2024, "Puzzle Piece": "", "Em&a": "", Notes: "", "Time Signature": "" },
                { Index: 9, Card: "9", Title: "7 Years Old", Artist: "Lukas Graham", Key: "Bb", BPM: "", Date: 2015, "Puzzle Piece": "", "Em&a": "", Notes: "1765363", "Time Signature": "" },
                { Index: 10, Card: "10", Title: "Ode To Joyful", Artist: "Jon Batiste", Key: "D", BPM: "", Date: 2024, "Puzzle Piece": "", "Em&a": "", Notes: "", "Time Signature": "" },
                { Index: 11, Card: "J", Title: "The Rose", Artist: "Bette Midler", Key: "C?", BPM: "", Date: 1979, "Puzzle Piece": "", "Em&a": "", Notes: "", "Time Signature": "" },
                { Index: 12, Card: "Q", Title: "If I Aint Got You", Artist: "0", Key: "", BPM: "", Date: 2002, "Puzzle Piece": "", "Em&a": "", Notes: "", "Time Signature": "" },
                { Index: 13, Card: "K", Title: "Hold Me", Artist: "Teddy Swims", Key: "", BPM: "", Date: 2022, "Puzzle Piece": "", "Em&a": "", Notes: "", "Time Signature": "" }
            ];
            
            renderSongTable();
        }
        
        // Function to render the song table
        function renderSongTable() {
            const tableBody = document.getElementById('songTableBody');
            tableBody.innerHTML = '';
            
            songData.forEach(song => {
                if (!song.Title && !song.Artist) return; // Skip empty rows
                
                const row = document.createElement('tr');
                row.onclick = () => showSongDetails(song);
                
                const clubCell = document.createElement('td');
                clubCell.className = 'club';
                clubCell.textContent = getSuitSymbol(song.Card) + ' ' + song.Card;
                row.appendChild(clubCell);
                
                const infoCell = document.createElement('td');
                const titleDiv = document.createElement('div');
                titleDiv.className = 'song-title';
                titleDiv.textContent = song.Title || '';
                infoCell.appendChild(titleDiv);
                
                const artistDiv = document.createElement('div');
                artistDiv.className = 'song-artist';
                artistDiv.textContent = song.Artist || '';
                infoCell.appendChild(artistDiv);
                row.appendChild(infoCell);
                
                const puzzleCell = document.createElement('td');
                puzzleCell.textContent = song["Puzzle Piece"] || '';
                row.appendChild(puzzleCell);
                
                const keyCell = document.createElement('td');
                keyCell.textContent = song.Key || '';
                row.appendChild(keyCell);

                // const rhythmCell = document.createElement('td');
                // rhythmCell.textContent = song["Em&a"] || '';
                // row.appendChild(rhythmCell);
                
                tableBody.appendChild(row);
            });
        }
        
        // Function to show song details
        function showSongDetails(song) {
            const detailCard = document.getElementById('detailCard');
            detailCard.classList.remove('hidden');
            
            // Format the card content
            detailCard.innerHTML = `
                <div class="detail-header">
                    <div class="card-symbol">${getSuitSymbol(song.Card)} ${song.Card}</div>
                    <div class="card-title">
                        <h2>${song.Title}</h2>
                        <p>${song.Artist}</p>
                    </div>
                    <div class="card-info">
                        <div>üîë ${song.Key}</div>
                        <div>üìÖ ${song.Date || ''}</div>
                        <div>‚ù§Ô∏è ${song.BPM || ''}</div>
                    </div>
                </div>
                <div class="detail-content">
                    ${song["Em&a"] ? `<p>Em&a: ${song["Em&a"]}</p>` : ''}
                    ${song.Notes ? `<p>${song.Notes}</p>` : ''}
                    ${song["Time Signature"] ? `<p>Time Signature: ${song["Time Signature"]}</p>` : ''}
                    ${song["Puzzle Piece"] ? `
                        <div class="puzzle-piece">
                            <div class="puzzle-icon">üß©</div>
                            <div>${song["Puzzle Piece"]}</div>
                        </div>
                    ` : ''}
                </div>
            `;
            
            // Scroll to the detail card
            detailCard.scrollIntoView({ behavior: 'smooth' });
        }
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', () => {
            // Try to load CSV data, with fallback to hardcoded data
            loadSongData();
        });
    </script>
</body>
</html>
